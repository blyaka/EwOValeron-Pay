<div class="sub-nav-lk-container" id="lkNav">
  <!-- ТОЛЬКО ДЛЯ МОБИЛКИ -->
  <button class="sub-nav-toggle" type="button" aria-expanded="false">
    <span>Страницы личного кабинета</span>
    <svg class="chev" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M6.7 8.7a1 1 0 0 1 1.4 0L12 12.6l3.9-3.9a1 1 0 1 1 1.4 1.4l-4.6 4.6a1 1 0 0 1-1.4 0L6.7 10.1a1 1 0 0 1 0-1.4z" fill="currentColor"/>
    </svg>
  </button>

  <div class="sub-nav-lk" id="lkNavList" hidden>
    <a href="{% url 'brief-stats' %}">Краткая статистика</a>
    <a href="{% url 'payment-status' %}">Статус платежей</a>
    <a href="{% url 'withdraw' %}">Выводы</a>
    <a href="{% url 'report-generation' %}">Генерация отчета</a>
    <a href="{% url 'notification %'}">Уведомления</a>
    <a href="{% url 'payment-links' %}">Платежные ссылки</a>
    <a href="{% url 'chargers-hidtory' %}">История чарж-беков</a>
  </div>
</div>


<script>
(() => {
  const wrap = document.getElementById('lkNav');
  if (!wrap) return;
  const btn  = wrap.querySelector('.sub-nav-toggle');
  const list = document.getElementById('lkNavList');
  const mq   = window.matchMedia('(max-width: 768px)');

  const setMode = () => {
    if (mq.matches) {
      btn.style.display = 'flex';
      wrap.classList.remove('is-open');
      list.hidden = true;
      list.style.maxHeight = '0px';
      btn.setAttribute('aria-expanded','false');
    } else {
      btn.style.display = 'none';
      list.hidden = false;
      list.style.maxHeight = 'none';
      btn.setAttribute('aria-expanded','true');
    }
  };

  setMode();
  mq.addEventListener('change', setMode);

  const openList = () => {
    list.hidden = false;               // вернуть в поток
    list.style.maxHeight = '0px';      // старт
    // дождаться лэйаута
    requestAnimationFrame(() => {
      // форсим рефлоу
      void list.offsetHeight;
      const h = list.scrollHeight;
      list.style.maxHeight = h + 'px';
      wrap.classList.add('is-open');
      btn.setAttribute('aria-expanded','true');
    });
  };

  const closeList = () => {
    // зафиксировать текущее и схлопнуть
    list.style.maxHeight = list.scrollHeight + 'px';
    requestAnimationFrame(() => {
      list.style.maxHeight = '0px';
      wrap.classList.remove('is-open');
      btn.setAttribute('aria-expanded','false');
    });
  };

  btn.addEventListener('click', () => {
    const open = wrap.classList.contains('is-open');
    open ? closeList() : openList();
  });

  list.addEventListener('transitionend', () => {
    if (!wrap.classList.contains('is-open')) list.hidden = true;
    else list.style.maxHeight = 'none'; // раскрывшись — убираем ограничение
  });
})();
</script>

